function preload(){game.load.image("pad","assets/Knee.png"),game.load.image("ball","assets/cball.png"),game.load.image("sky","assets/sky.png"),game.load.image("shoe","assets/Shoe.png"),game.load.image("thigh_pad","assets/Thigh.png"),game.load.image("t_shirt3","assets/upper_body.png"),game.load.image("shoulder","assets/arm.png"),game.load.image("arm","assets/wrist.png"),game.load.image("bat","assets/bat.png"),game.load.image("star","assets/star.png"),game.load.image("wicket","assets/wicket.jpg"),game.load.image("wicket_dislodged","assets/wicket_dislodged.jpg"),game.load.image("head","assets/head.png"),game.load.image("scorecard","assets/scorecard.jpg")}function rads(a){return 3.1416*a/180}function repeat(a,b){function c(){a(),setTimeout(c,b)}c()}function createBoneSprite(a,b,c){var d=game.add.sprite(100,100,b);return game.physics.p2.enable(d),d.body.clearShapes(),d.body.addLine(c,0,0,0),d.body.clearCollision(!0,!0),d.body.setCollisionGroup(C_BODY),d.body.collides([C_GROUND]),sprites[a]=d,d}function createSkeleton(a,b){function c(a,b){setTimeout(function(){a.setLimits(b.min,b.max)},b.delay)}a.sort(function(a,b){return-(a.zindex-b.zindex)});for(var d in a){var e=a[d],f=createBoneSprite(e.id,e.assetKey,e.length);f.body.x=e.position.x,f.body.y=e.position.y,f.body.rotation=e.position.angle,f.body.angularDamping=.8,f.body.damping=.8}for(var g in b){var h=b[g],i=game.physics.p2.createRevoluteConstraint(sprites[h.a.bone],h.a.pivot,sprites[h.b.bone],h.b.pivot);for(var j in h.limits){var k=h.limits[j];c(i,k)}}}function glueLegs(){var a=game.add.sprite(OX+DBL,OY,"shoe");sprites.leftShoe=a,game.physics.p2.enable(a),a.body.clearCollision(!0,!0),a.body["static"]=!0;var b=game.add.sprite(OX,OY,"shoe");sprites.rightShoe=b,game.physics.p2.enable(b),b.body.clearCollision(!0,!0),b.body["static"]=!0,game.physics.p2.createDistanceConstraint(a,sprites.lowerLeftLeg,0,[-10,-20],[-lowerLegSize/2,0]),game.physics.p2.createDistanceConstraint(b,sprites.lowerRightLeg,0,[0,-10],[-lowerLegSize/2,0])}function addScoreCard(){var a=game.add.sprite(8,8,"scorecard");a.scale.setTo(.15,.15)}function addBat(){var a=game.add.sprite(0,0,"bat");sprites.bat=a,game.physics.p2.enable(a),a.body.clearCollision(!0,!0),a.body.clearShapes(),a.body.addRectangle(180,45),a.body.setCollisionGroup(C_BAT),a.body.collides([C_BALL,C_WICKET,C_GROUND]),a.body.setMaterial(materials.bat),a.body.x=OX+100,a.body.y=OY-100;var b=game.physics.p2.createRevoluteConstraint(sprites.bat,[-batSize/2+10,5],sprites.lowerLeftArm,[lowerArmSize/2,0]);b.setLimits(rads(-25),rads(-20)),b=game.physics.p2.createRevoluteConstraint(sprites.bat,[-batSize/2+30,15],sprites.lowerRightArm,[lowerArmSize/2,0])}function bowled(){0==gameover&&(wickets++,wickets==max_wickets&&(gameover=1))}function hit_wicket(){0==gameover&&(wickets++,wickets==max_wickets&&(gameover=1))}function collide_wall(){update_meter=1,velocityBar.currentProgress=0;var a=sprites.ball,b=game.physics.p2.gravity.y,c=OY-a.body.y,d=a.body.velocity.y,e=(-d+Math.sqrt(d*d+2*c*b))/b,f=Math.abs(a.body.velocity.x)*e;if(stats.prev_runs=stats.runs_scored,a.bounced_after_bat===!1)distText.text="six dist: "+f,f>=2400?(stats.sixes.push(f),stats.runs_scored+=6):(distText.text="OUT!",0==gameover&&(wickets++,wickets==max_wickets&&(gameover=1)));else{distText.text="ball speed: "+Math.abs(a.body.velocity.x);var g=Math.abs(a.body.velocity.x),h=0;g>=1300?(h=4,stats.num_fours+=1,g=1500):g>=1200?h=3:g>=1e3?h=2:g>=600&&(h=1),velocityBar.progress=128*g/1500,velocityBar.colour=h,distText.text=h,stats.runs_scored+=h}}function collide_ground(){var a=this;a.hit_bat===!0&&(a.bounced_after_bat=!0)}function collide_bat(){var a=this;a.hit_bat=!0}function addWicket(){var a=game.add.sprite(OWX,OWY,"wicket");sprites.wicket=a,game.physics.p2.enable(a),a.body.clearCollision(!0,!0),a.body.setCollisionGroup(C_WICKET),a.body.collides(C_BALL,bowled,this),a.body.collides(C_BAT,hit_wicket,this),a.body["static"]=!0}function addGround(){var a=game.add.sprite(0,OY);sprites.ground=a,game.physics.p2.enable(a),a.body.clearShapes(),a.body.addPlane(),a.body.clearCollision(!0,!0),a.body.setCollisionGroup(C_GROUND),a.body.collides([C_BALL,C_BODY]),a.body["static"]=!0,a.body.setMaterial(materials.ground);var b=game.add.sprite(0,OY+30);game.physics.p2.enable(b),b.body.clearShapes(),b.body.addPlane(),b.body.clearCollision(!0,!0),b.body.setCollisionGroup(C_GROUND),b.body.collides([C_BAT]),b.body["static"]=!0}function addVelocityBar(){console.log("yes"),velocityBar.progress=128,velocityBar.image=game.add.bitmapData(128,8),game.add.sprite(game.world.centerX+.4*game.world.width-.5*velocityBar.image.width,game.world.centerY-.4*game.world.height,velocityBar.image)}function updateScoreCard(){stats.prev_runs<stats.runs_scored?(stats.prev_runs+=1,runsText.text="Runs:          "+stats.prev_runs,update_meter=3):stats.prev_runs==stats.runs_scored&&(update_meter=0)}function updateVelocityBar(){console.log("yep"),velocityBar.image.context.clearRect(0,0,velocityBar.image.width,velocityBar.image.height),0==velocityBar.colour?(velocityBar.image.context.fillStyle="#fff",distText.addColor("#fff",0)):1==velocityBar.colour?(velocityBar.image.context.fillStyle="#aaa",distText.addColor("#aaa",0)):2==velocityBar.colour?(velocityBar.image.context.fillStyle="#00f",distText.addColor("#00f",0)):3==velocityBar.colour?(velocityBar.image.context.fillStyle="#0f0",distText.addColor("#0f0",0)):(4==velocityBar.colour||6==velocityBar.colour)&&(velocityBar.image.context.fillStyle="#f00",distText.addColor("#f00",0)),velocityBar.currentProgress==velocityBar.progress?(velocityBar.image.context.fillRect(0,0,velocityBar.currentProgress,8),update_meter=2):velocityBar.currentProgress<velocityBar.progress?(velocityBar.image.context.fillRect(0,0,velocityBar.currentProgress,8),velocityBar.currentProgress+=1):update_meter=2,velocityBar.image.dirty=!0}function createBall(){var a=game.add.sprite(0,0,"ball");sprites.ball=a,game.physics.p2.enable(a),a.body.clearShapes(),a.body.addCircle(20),a.body.mass=.8,a.body.clearCollision(!0,!0),a.body.setCollisionGroup(C_BALL),a.body.collides([C_WICKET]),a.body.collides(C_GROUND,collide_ground,a),a.body.collides(C_BAT,collide_bat,a),a.body.setMaterial(materials.ball),a.hit_bat=!1,a.bounced_after_bat=!1;var b=getBowlingPlan();return function(){no_of_balls+=1,ballText.text="Overs:        "+parseInt(no_of_balls/6)+"."+no_of_balls%6,stats.balls_faced+=1;var c=b();a.body.x=1e3,a.body.y=100,a.body.velocity.x=c.vx,a.body.velocity.y=c.vy,a.body.angularVelocity=c.spin,materials.groundBall.friction=c.friction,materials.groundBall.restitution=c.restitution,a.hit_bat=!1,a.bounced_after_bat=!1}}function createMaterials(){materials.bat=game.physics.p2.createMaterial("batMaterial"),materials.ball=game.physics.p2.createMaterial("ballMaterial"),materials.ground=game.physics.p2.createMaterial("groundMaterial"),materials.wall=game.physics.p2.createMaterial("wallMaterial"),materials.groundBall=game.physics.p2.createContactMaterial(materials.ground,materials.ball),materials.groundBall.restitution=.45,materials.groundBall.stiffness=1e7,materials.groundBall.friction=7,materials.batBall=game.physics.p2.createContactMaterial(materials.bat,materials.ball),materials.batBall.restitution=.5,materials.batBall.stiffness=1e6,materials.batBall.friction=5}function create(){console.log("create"),$("#phaser-example").first().children().first().css("display","inline"),game.stage.backgroundColor="#7ec0ee",game.physics.startSystem(Phaser.Physics.P2JS),game.physics.p2.setImpactEvents(!0),game.physics.p2.world.iterations=5,game.physics.p2.gravity.y=500,C_BAT=game.physics.p2.createCollisionGroup(),C_BALL=game.physics.p2.createCollisionGroup(),C_GROUND=game.physics.p2.createCollisionGroup(),C_WICKET=game.physics.p2.createCollisionGroup(),C_WALL=game.physics.p2.createCollisionGroup(),C_BODY=game.physics.p2.createCollisionGroup(),createMaterials(),createSkeleton(skeleton,joints),glueLegs(),addGround(),addWicket(),addVelocityBar(),distText=game.add.text(256,16,"Dist",{fontSize:"32px",fill:"#000"}),practiceText=game.add.text(256,88,"...",{fontSize:"16px",fill:"#000"}),addBat(),addScoreCard(),ballText=game.add.text(16,48,"Overs:        0.0",{fontSize:"20px",fill:"#fff"}),runsText=game.add.text(16,24,"Dist",{fontSize:"20px",fill:"#000"}),setTimeout(startMouseInput,300),past_time=(new Date).getTime()-3e3,bowl=createBall()}function startMouseInput(){mouseSprite=game.add.sprite(0,0),game.physics.p2.enable(mouseSprite),mouseSprite.body.clearCollision(!0,!0),mouseSprite.body["static"]=!0,game.input.addMoveCallback(move,this),game.physics.p2.createRevoluteConstraint(mouseSprite,[0,0],sprites.bat,[0,0],700)}function move(){null!==mouseSprite&&(mouseSprite.body.x=game.input.mousePointer.x,mouseSprite.body.y=game.input.mousePointer.y)}function update(){if(idle!==!0){if(reset_required===!0&&(reset(),reset_required=!1),practice===!0&&game.input.keyboard.isDown(Phaser.Keyboard.SPACEBAR))return reset(),practiceText.text="Match on!",practice=!1,void Math.seedrandom(seed);if(sprites.lowerRightLeg.body.applyForce([0,100],sprites.lowerRightLeg.x,sprites.lowerRightLeg.y),sprites.lowerLeftLeg.body.applyForce([50,100],sprites.lowerLeftLeg.x,sprites.lowerLeftLeg.y),sprites.spine.body.applyForce([0,100],sprites.spine.x,sprites.spine.y),0==gameover||practice===!0)console.log(update_meter),0==update_meter?(check_runs&&(sprites.ball.body.x>=WIDTH+100||sprites.ball.body.y<=0)&&(check_runs=!1,collide_wall()),practice===!1&&stats.balls_faced>=max_balls&&(wickets++,wickets==max_wickets&&(gameover=1)),present_time=(new Date).getTime(),present_time-past_time>=3e3&&(bowl(),check_runs=!0,past_time=present_time)):1==update_meter?(updateVelocityBar(),present_time=(new Date).getTime()):2==update_meter?updateScoreCard():3==update_meter&&(stats.waiting<50?stats.waiting+=1:50==stats.waiting&&(stats.waiting=0,console.log("yes"),update_meter=2));else if(1==gameover&&(gameover=2,seed++,Math.seedrandom(seed),sprites.wicket.loadTexture("wicket_dislodged"),ballText.text="GAME OVER",null!==onGameOver)){var a=onGameOver(stats);a&&reset()}}}function reset(){gameover=0,sprites.wicket.loadTexture("wicket"),no_of_balls=0,wickets=0,stats={balls_faced:0,runs_scored:0,num_fours:0,prev_runs:0,waiting:0,sixes:[],balls:[]},sprites.ball.body.x=WIDTH,sprites.ball.body.velocity.x=0,past_time=(new Date).getTime(),practice=!0,ballText.text="Let's begin!",practiceText.text="Get some practice and press SPACE when you are ready",displayStats()}function displayStats(){runsText.text="Runs:          "+stats.runs_scored,ballText.text="Overs:        0.0"}function startGame(a,b,c){seed=b,a===G_SOLO?Math.seedrandom(seed):Math.seedrandom("42"),onGameOver=c,reset_required=!0,idle=!1,game_mode=a,a===G_SOLO?(max_balls=1e7,max_wickets=1):(max_balls=30,max_wickets=2)}HEIGHT=600,WIDTH=1e3;var game=new Phaser.Game(WIDTH,HEIGHT,Phaser.CANVAS,"phaser-example",{preload:preload,create:create,update:update});G_SOLO=0,G_CHALLENGER=1,G_CHALLENGEE=2;var cursors,sprites={},mouseSprite=null,materials={},gameover=0,ballText,no_of_balls=0,game_mode=G_SOLO,practice=!0,velocityBar={},update_meter=0,seed=0,max_balls,max_wickets,wickets=0,stats={balls_faced:0,runs_scored:0,num_fours:0,sixes:[],balls:[]},distText,runsText,practiceText,bowl,onGameOver=null,idle=!0,reset_required=!0;C_BAT=null,C_BALL=null,C_GROUND=null,C_WICKET=null,C_WALL=null,C_BODY=null,OX=150,OY=500,OWX=15,OWY=435,DBL=230,SCALE=100;var lowerLegSize=1.05*SCALE,upperLegSize=1.05*SCALE,spineSize=1.26*SCALE,upperArmSize=.88*SCALE,lowerArmSize=.8*SCALE,tboneSize=.35*SCALE,tboneLSize=0*SCALE,batSize=1.75*SCALE,batSizeW=.3*SCALE,headSize=.88*SCALE,skeleton=[{id:"head",assetKey:"head",length:headSize,position:{x:OX+DBL/2,y:OY-(lowerLegSize+upperLegSize+spineSize/2),angle:rads(-90)},zindex:0},{id:"lowerLeftLeg",assetKey:"pad",length:lowerLegSize,position:{x:OX+DBL,y:OY,angle:rads(-90)},zindex:-10},{id:"lowerRightLeg",assetKey:"pad",length:lowerLegSize,position:{x:OX,y:OY,angle:rads(-90)},zindex:-10},{id:"upperLeftLeg",assetKey:"thigh_pad",length:upperLegSize,position:{x:OX+DBL,y:OY-lowerLegSize,angle:rads(-90)},zindex:-5},{id:"upperRightLeg",assetKey:"thigh_pad",length:upperLegSize,position:{x:OX,y:OY-lowerLegSize,angle:rads(-90)},zindex:-7},{id:"spine",assetKey:"t_shirt3",length:spineSize,position:{x:OX+DBL/2,y:OY-(lowerLegSize+upperLegSize),angle:rads(-90)},zindex:0},{id:"lowerLeftArm",assetKey:"arm",length:lowerArmSize,position:{x:OX+DBL,y:OY-(lowerLegSize+upperLegSize+spineSize-upperArmSize-lowerArmSize),angle:rads(90)},zindex:-12},{id:"lowerRightArm",assetKey:"arm",length:lowerArmSize,position:{x:OX,y:OY-(lowerLegSize+upperLegSize+spineSize-upperArmSize-lowerArmSize),angle:rads(90)},zindex:-12},{id:"upperLeftArm",assetKey:"shoulder",length:upperArmSize,position:{x:OX+DBL,y:OY-(lowerLegSize+upperLegSize+spineSize-lowerArmSize),angle:rads(-90)},zindex:1},{id:"upperRightArm",assetKey:"shoulder",length:upperArmSize,position:{x:OX,y:OY-(lowerLegSize+upperLegSize+spineSize-lowerArmSize),angle:rads(-90)},zindex:-11}],joints={head:{a:{bone:"head",pivot:[-headSize/2,0]},b:{bone:"spine",pivot:[spineSize/2-15,30]},limits:[{min:rads(0),max:rads(0),delat:0}]},leftKnee:{a:{bone:"lowerLeftLeg",pivot:[lowerLegSize/2-20,0]},b:{bone:"upperLeftLeg",pivot:[-upperLegSize/2,0]},limits:[{min:rads(-120),max:rads(-20),delay:0}]},rightKnee:{a:{bone:"lowerRightLeg",pivot:[lowerLegSize/2-20,0]},b:{bone:"upperRightLeg",pivot:[-upperLegSize/2,0]},limits:[{min:rads(-55),max:rads(-5),delay:0}]},leftPelvis:{a:{bone:"upperLeftLeg",pivot:[upperLegSize/2,0]},b:{bone:"spine",pivot:[-spineSize/2+10,5]},limits:[{min:rads(10),max:rads(60),delay:0}]},rightPelvis:{a:{bone:"upperRightLeg",pivot:[upperLegSize/2,0]},b:{bone:"spine",pivot:[-spineSize/2+10,-5]},limits:[{min:rads(-20),max:rads(100),delay:0}]},leftShoulder:{a:{bone:"upperLeftArm",pivot:[-upperArmSize/2,0]},b:{bone:"spine",pivot:[spineSize/2-10,tboneSize/2]},limits:[{min:rads(-210),max:rads(-50),delay:0}]},rightShoulder:{a:{bone:"upperRightArm",pivot:[-upperArmSize/2,0]},b:{bone:"spine",pivot:[spineSize/2-10,-tboneSize/2]},limits:[{min:rads(40),max:rads(230),delay:0}]},leftElbow:{a:{bone:"lowerLeftArm",pivot:[-lowerArmSize/2+10,0]},b:{bone:"upperLeftArm",pivot:[upperArmSize/2-10,0]},limits:[{min:rads(-150),max:rads(-30),delay:0}]},rightElbow:{a:{bone:"lowerRightArm",pivot:[-lowerArmSize/2+10,0]},b:{bone:"upperRightArm",pivot:[upperArmSize/2-10,-2]},limits:[{min:rads(30),max:rads(150),delay:0}]}},check_runs=!1;